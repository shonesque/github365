!function(p,r){var a=/iPad|iPhone|iPod/.test(navigator.platform),c={globalTabIndexElementFilter:":not(.a11y-ignore)",focusableElementsFilter:":visible:not(.disabled):not([tabindex='-1']):not(:disabled):not(.a11y-ignore-focus)",ariaLabelElementsFilter:":not( .a11y-ignore-aria [aria-label] )",ariaHiddenParentsFilter:":not(#wrapper):not(body)"},v={focuser:"#a11y-focuser",focusguard:".a11y-focusguard",selected:"#a11y-selected",ignoreFocusElements:".a11y-ignore-focus",nativeSpaceElements:"textarea, input[type='text'], div[contenteditable=true]",nativeEnterElements:"textarea, a, button, input[type='checkbox'], input[type='radio']",nativeTabElements:"textarea, input, select",wrapIgnoreElements:"a,button,input,select,textarea",wrapStyleElements:"b,i,abbr,strong,em,small,sub,sup,ins,del,mark,zw,nb",globalTabIndexElements:"a,button,input,select,textarea,[tabindex]",focusableElements:"a,button,input,select,textarea,[tabindex],label",focusableElementsAccessible:":not(a,button,input,select,textarea)[tabindex]",hideableElements:".a11y-hideable",ariaLabelElements:"div[aria-label], span[aria-label]"},u={focuser:'<a id="a11y-focuser" href="#" class="prevent-default a11y-ignore" tabindex="-1" role="presentation" aria-label=".">&nbsp;</a>',focusguard:'<a class="a11y-focusguard a11y-ignore a11y-ignore-focus" tabindex="0" role="button">&nbsp;</a>',selected:'<a id="a11y-selected" href="#" class="prevent-default a11y-ignore" tabindex="-1">&nbsp;</a>',arialabel:"<span class='aria-label prevent-default' tabindex='0' role='region'></span>"};function g(e){return e.replace(g.regex,"")}function o(e,t,a){var n=t||this,l=arguments;return setTimeout(function(){e.apply(n,l)},a||0)}function n(e){e.preventDefault(),e.stopPropagation()}function l(e){var t=p.a11y.state,a=p.a11y.options;if((a.isDebug&&console.log("preventScroll1"),t.scrollDisabledElements&&0<t.scrollDisabledElements.length)&&0===d(e).filter(t.scrollDisabledElements).length)return void p(r).scroll();return a.isDebug&&console.log("preventScroll2"),e.preventDefault(),!1}g.regex=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;var i={37:1,38:1,39:1,40:1};function s(e){var t=p.a11y.state,a=p.a11y.options;if(!p(e.target).is(v.nativeTabElements)){if(a.isDebug&&console.log("preventScroll1"),t.scrollDisabledElements&&0<t.scrollDisabledElements.length)if(0===d(e).filter(t.scrollDisabledElements).length)return;return a.isDebug&&console.log("preventScroll2"),i[e.keyCode]?(l(e),!1):void 0}}function d(e){var t,a,n=p(e.target);if("touchmove"==e.type){var l=p.a11y.state;if(!l.scrollStartEvent||!l.scrollStartEvent.originalEvent)return n;var i=e.originalEvent.pageY,s=l.scrollStartEvent.originalEvent.pageY;if(0!==i&&i!=s||(i=e.originalEvent.touches[0].pageY,s=l.scrollStartEvent.originalEvent.touches[0].pageY),0===(t=i-s))return p("body");a=0<t?"up":"down"}else{if(0===(t=e.originalEvent.wheelDeltaY||void 0!==e.originalEvent.deltaY?-e.originalEvent.deltaY:e.originalEvent.wheelDelta||void 0))return p("body");a=0<t?"up":"down"}for(var r=n.parents(),o=0,d=r.length;o<d;o++){var c=p(r[o]);if(c.is("body"))return c;switch(c.css("overflow-y")){case"auto":case"scroll":var u=Math.ceil(c.scrollTop()),f=c.outerHeight(),b=c[0].scrollHeight;switch(a){case"down":if(u+f<b)return c;break;case"up":if(0<u)return c}c}}return p("body")}function f(e){return function(e){for(var t="",a=0;a<e[0].children.length;a++)t+=e[0].children[a].outerHTML;return t}(function e(t){var a=t.children();if(0===a.length){var n=t.text();return""===g(n)||(b(t),t.append(h(p("<span>"+n+"</span>")))),t}var l=0;for(var i=0;i<a.length;i++)p(a[i]).is(v.wrapStyleElements)&&l++;if(l===a.length)return p("<span>").append(h(t));var s=[];var r=[];for(var o=0;o<t[0].childNodes.length;o++){var d=t[0].childNodes[o],c=p(d.outerHTML)[0];switch(d.nodeType){case 3:if(!g(d.textContent))break;r.push(d.textContent);break;case 1:var u=p(c);if(u.is(v.wrapStyleElements)||u.is(v.wrapIgnoreElements))r.push(u[0].outerHTML);else{var f=u.children();if(0===f.length){var n=u.text();""!==g(n)&&h(u)}else e(u);r.length&&(s.push(h(p("<span>"+r.join("")+"</span>"))),r.length=0),s.push(u)}}}r.length&&(s.push(h(p("<span>"+r.join("")+"</span>"))),r.length=0);b(t);t.append(s);return t;function b(e){for(var t=e[0].childNodes.length,a=t-1;-1<a;a--)e[0].childNodes[a].remove?e[0].childNodes[a].remove():e[0].removeChild?e[0].removeChild(e[0].childNodes[a]):e[0].childNodes[a].removeNode&&e[0].childNodes[a].removeNode(!0);return e}function h(e){return e.attr({role:"region",tabindex:0}).addClass("prevent-default"),e}}(function(e){var t;try{t=p("<div>"+e+"</div>")}catch(e){throw e}return t}(e)))}function b(e){var t=p.a11y.options,a=p(e.target);switch(e.which){case 32:if(a.is(v.nativeSpaceElements))return;n(e),t.isDebug&&console.log("a11y: space keyup > click"),a.trigger("click");break;case 27:t.isDebug&&console.log("a11y: escape keyup > focus on first element"),p.a11y_focus()}}function h(e){var t=p.a11y.options,a=p(e.target);switch(e.which){case 32:if(a.is(v.nativeSpaceElements))return;n(e),t.isDebug&&console.log("a11y: space keydown > blocked default");break;case 13:if(a.is(v.nativeEnterElements))return;n(e),t.isDebug&&console.log("a11y: enter keydown > click"),a.trigger("click")}}function m(e){var t=p.a11y.options,a=p.a11y.state,n=p(e.target);if(!n.is(v.globalTabIndexElements)){var l=n.parents(),i=l.filter(v.globalTabIndexElements);if(0===i.length){var s=l.filter("[for]");if(0===s.length)n=n.focusOrNext(!0);else{var r=p("#"+s.attr("for"));n=r.is(v.globalTabIndexElements)?r:n.focusOrNext(!0)}}else n=p(i[0])}a.$activeElement=n,t.isDebug&&console.log("focusCapture",n[0])}function y(e){var t=p.a11y.options,a=p.a11y.state,n=p(e.target);if(n.is(v.globalTabIndexElements)){!function(e){var t;if(e.attr("aria-labelledby")){var a=p("#"+e.attr("aria-labelledby"));t=a.attr("aria-label")||a.text()}else t=e.attr("aria-label")||e.text();p(document).trigger("reading",g(t))}(n),t.isDebug&&console.log("focus",n[0]),a.$activeElement=p(e.currentTarget),a.$activeElement.is(v.nativeTabElements)&&(p.a11y.userInteracted=!0);t=p.a11y.options;n.limitedScrollTo()}}function E(e){return p.a11y.state.scrollStartEvent=e,!0}function x(e){return!(p.a11y.state.scrollStartEvent=null)}function T(){var e=p.a11y.state.floorStack[p.a11y.state.floorStack.length-1];1==p.a11y.state.floorStack.length?0===e.find(v.focusguard).length&&p(u.focusguard).appendTo(e).attr("tabindex",0):0===e.find(v.focusguard).length&&(console.warn("DEPRECATED (a11y_reattachFocusGuard) - Use the Handlebars helper a11y_wrap_focus after the last tabbable element in the popup"),p(u.focusguard).appendTo(e).attr("tabindex",0))}p.fn.scrollDisable=function(){if(0===this.length)return this;var e,t=p.a11y.options,a=p.a11y.state;return t.isScrollDisableEnabled&&(a.scrollDisabledElements?a.scrollDisabledElements=a.scrollDisabledElements.add(this):a.scrollDisabledElements=p(this),0<a.scrollDisabledElements.length&&(e="wheel mousewheel",p(r).on(e,l),p(document).on(e,l),p(r).on("touchstart",E),p(r).on("touchmove",l),p(r).on("touchend",x),p(document).on("keydown",s))),this},p.fn.scrollEnable=function(){if(0===this.length)return this;var e,t=p.a11y.options,a=p.a11y.state;if(!t.isScrollDisableEnabled)return this;a.scrollDisabledElements&&(a.scrollDisabledElements=a.scrollDisabledElements.not(this),0===a.scrollDisabledElements.length&&(e="wheel mousewheel",p(r).off(e,l),p(document).off(e,l),p(r).off("touchstart",E),p(r).off("touchmove",l),p(r).off("touchend",x),p(document).off("keydown",s)))},p.fn.isFixedPostion=function(){if(0===this.length)return!1;var e=p(this[0]);if(!e)return!1;if("fixed"==e.css("position"))return!0;if(e.is(".fixed"))return!0;for(var t=e.parents(),a=0,n=t.length;a<n;a++){if("fixed"==p(t[a]).css("position"))return!0;if(p(t[a]).is(".fixed"))return!0}return!1},p.fn.limitedScrollTo=function(){var e=p.a11y.options;if(!e.isFocusLimited)return this;if(0===this.length)return this;var t=p(this[0]);if(t.isFixedPostion())return this;var a=(e=e||{}).focusOffsetTop||0,n=e.focusOffsetTop||0,l=t.offset().top,i=(p(r).scrollTop(),p(r).innerHeight()-n-a),s=l-a-i/2;return s<0&&(s=0),e.isDebug&&console.log("limitedScrollTo",s),o(function(){p.scrollTo(this.scrollToPosition,{duration:0})},{scrollToPosition:s}),this},p.fn.focusNoScroll=function(){return 0===this.length||o(function(){p.a11y.options.isDebug&&console.log("focusNoScroll",this[0]);var e=p(r).scrollTop();try{this[0].focus()}catch(e){}r.scrollTo(null,e)},this),this},p.fn.focusOrNext=function(e){if(0===this.length)return this;var t=p(this[0]),a=t.is(v.focuser)||t.is(v.focusguard)||t.is(v.selected),n=t.is(v.focusableElements)&&t.is(c.focusableElementsFilter);if(!a&&!n){var l=t.nextAll(v.focusableElements),i=l.filter(c.focusableElementsFilter);if(0===l.length||0===i.length){var s=t.parents().nextAll().find(v.focusableElements).filter(c.focusableElementsFilter);t=0===s.length?p(v.focuser):p(s[0])}else t=p(i[0])}var r=p.a11y.options;return r.isDebug&&console.log("focusOrNext",t[0]),!0!==e&&("mac"!=r.OS&&p(v.focuser).focusNoScroll(),t.focusNoScroll()),t},p.a11y=function(e,t){return p.a11y.options.isDebug&&console.log("$.a11y called",e,t),this},p.a11y.options={focusOffsetTop:0,focusOffsetBottom:0,animateDuration:250,OS:"",isTouchDevice:!1,isTabbableTextEnabled:!1,isUserInputControlEnabled:!0,isFocusControlEnabled:!0,isFocusLimited:!1,isRemoveNotAccessiblesEnabled:!0,isAriaLabelFixEnabled:!0,isFocusWrapEnabled:!0,isScrollDisableEnabled:!0,isScrollDisabledOnPopupEnabled:!1,isSelectedAlertsEnabled:!1,isAlertsEnabled:!1,isDebug:!1},p.a11y.state={$activeElement:null,floorStack:[p("body")],focusStack:[],tabIndexes:{},elementUIDIndex:0,scrollDisabledElements:null,scrollStartEvent:null},p.a11y.ready=function(){var t,e=p.a11y.options;a&&(e.OS="mac"),0===p(v.selected).length&&p("body").append(p(u.selected)),0===p(v.focuser).length&&p("body").append(p(u.focuser)),t=p.a11y.options,p.a11y.state.isFocusGuardSetup||(p.a11y.state.isFocusGuardSetup=!0,p("body").on("click focus",v.focusguard,function(e){return t.isDebug&&console.log("focusguard"),n(e),p.a11y_focus(!0),!1})),e.isUserInputControlEnabled&&(p("body").off("click",".prevent-default",n).off("keyup",b).off("keydown",h),p("body").on("click",".prevent-default",n).on("keyup",b).on("keydown",h)),e.isFocusControlEnabled&&(p.a11y.options,p("body").off("mousedown touchstart",v.focusableElements,m).off("focus",v.globalTabIndexElements,y),p("body").on("mousedown touchstart",v.focusableElements,m).on("focus",v.globalTabIndexElements,y)),e.isFocusWrapEnabled&&T(),e.isDebug&&(console.log("a11y_ready"),p.a11y.state.isDebugApplied||(p.a11y.state.isDebugApplied=!0,p("body").on("focus blur click change","*",function(e){console.log("a11y_debug",e.type,e.currentTarget)})))},p.a11y_update=function(){var e=p.a11y.options;a&&(e.OS="mac"),e.isRemoveNotAccessiblesEnabled&&p(".not-accessible[tabindex='0'], .not-accessible [tabindex='0']").attr({tabindex:"-1","aria-hidden":!0}).addClass("aria-hidden"),e.isAriaLabelFixEnabled&&p("body").a11y_aria_label(!0),e.isFocusWrapEnabled&&T(),e.isTabbableTextEnabled||p(v.focusableElementsAccessible).attr({"aria-hidden":"true",tabindex:"-1"}),e.isDebug&&console.log("a11y_update")},p.a11y_on=function(e,t){return p.a11y.options.isDebug&&console.log("$.a11y_on called",e,t),t=t||"body",!1===(e=void 0===e||e)?p(t).attr("aria-hidden",!0):p(t).removeAttr("aria-hidden"),this},p.fn.a11y_on=function(e){return 0===this.length||(p.a11y.options.isDebug&&console.log("$.fn.a11y_on called",e,this),(e=void 0===e||e)?(p(v.focuser).focusNoScroll(),this.find(v.hideableElements).filter(c.globalTabIndexElementFilter).attr("aria-hidden","true").attr("tabindex","-1").addClass("aria-hidden")):this.find(v.hideableElements).filter(c.globalTabIndexElementFilter).attr("aria-hidden","false").removeAttr("tabindex").removeClass("aria-hidden"),this.find(v.globalTabIndexElements).filter(c.globalTabIndexElementFilter).a11y_cntrl(e)),this},p.fn.a11y_cntrl=function(e,t){if(0===this.length)return this;var a=p.a11y.options;e=void 0===e||e;for(var n=0;n<this.length;n++){var l=p(this[n]);e&&l.is(v.hideableElements)?(!a.isTabbableTextEnabled&&l.is(v.focusableElementsAccessible)||(l.removeAttr("aria-hidden").removeClass("aria-hidden"),l.parents(c.parentsFilter).removeAttr("aria-hidden").removeClass("aria-hidden")),t&&l.removeAttr("disabled").removeClass("disabled")):e?(!a.isTabbableTextEnabled&&l.is(v.focusableElementsAccessible)||(l.attr({tabindex:"0"}).removeAttr("aria-hidden").removeClass("aria-hidden"),l.parents(c.parentsFilter).removeAttr("aria-hidden").removeClass("aria-hidden")),t&&l.removeAttr("disabled").removeClass("disabled")):(!a.isTabbableTextEnabled&&l.is(v.focusableElementsAccessible)||l.attr({tabindex:"-1","aria-hidden":"true"}).addClass("aria-hidden"),t&&l.attr("disabled","disabled").addClass("disabled"))}return this},p.fn.a11y_cntrl_enabled=function(e){return 0===this.length?this:this.a11y_cntrl(e,!0)};var t=/&.*;/g;p.a11y_normalize=function(e){return p.a11y.options.isTabbableTextEnabled?e=(e=p("<div>"+e+"</div>").text()).replace(t,""):e},p.a11y_remove_breaks=function(e){if(!p.a11y.options.isTabbableTextEnabled)return e;var t=[p("<div>"+e+"</div>")[0]],a=0,n=[];do{if(t[a].childNodes.length){var l=t[a].childNodes,i=_.filter(l,function(e){return 3===e.nodeType||!!p(e).is(v.wrapStyleElements)});n.push.apply(n,i),t.push.apply(t,l)}a++}while(a<t.length);var s="";return n.forEach(function(e){s+=e.outerHTML||e.textContent}),s},p.a11y_text=function(e){return p.a11y.options.isTabbableTextEnabled?f(e):e},p.fn.a11y_text=function(e){if(!p.a11y.options.isTabbableTextEnabled)return e&&this.html(e),this;for(var t=0;t<this.length;t++)e=e||this[t].innerHTML,this[t].innerHTML=f(e);return this},p.fn.a11y_selected=function(e,t){if(0===this.length)return this;if(!p.a11y.options.isSelectedAlertsEnabled)return this;if(void 0===e&&(e=!0),e){var a=p(this[0]);switch(p.a11y.options.OS){case"mac":!0!==t&&p("#a11y-selected").focusNoScroll(),_.delay(function(){a.prepend(p("<span class='a11y-selected aria-label'>selected </span>")),!0!==t&&p(a).focusNoScroll()},250);break;default:!0!==t&&p.a11y_alert("selected "+a.text()),a.attr("aria-label","selected "+a.text()).addClass("a11y-selected")}}else switch(p.a11y.options.OS){case"mac":for(var n=0;n<this.length;n++)p(this[n]).find(".a11y-selected").remove();break;default:for(n=0;n<this.length;n++)p(this[n]).is(".a11y-selected")&&p(this[n]).removeClass("a11y-selected").removeAttr("aria-label"),p(this[n]).find(".a11y-selected").removeClass("a11y-selected").removeAttr("aria-label")}return this},p.a11y_alert=function(e){if(0===this.length)return this;var t=p.a11y.options;if(!t.isAlertsEnabled)return this;var a=p('<div role="alert">'+e+"</div>");switch(p(p.a11y).trigger("reading",e),t.OS){case"mac":p("#a11y-selected").append(a);break;default:a.css("visibility","hidden"),p("#a11y-selected").append(a),a.css("visibility","visible")}return setTimeout(function(){a.remove()},2e4),this},p.fn.a11y_only=function(e,l){if(0===this.length)return this;var t,a,i=p.a11y.state;return l&&i.focusStack.push(i.$activeElement),void 0!==e?(t=p(e).find(v.globalTabIndexElements).filter(c.globalTabIndexElementFilter),a=p(e).find(v.hideableElements).filter(c.globalTabIndexElementFilter)):(t=p(v.globalTabIndexElements).filter(c.globalTabIndexElementFilter),a=p(v.hideableElements).filter(c.globalTabIndexElementFilter)),t.each(function(e,t){var a,n=p(t);null==t.a11y_uid&&(t.a11y_uid="UID"+ ++i.elementUIDIndex),a=t.a11y_uid,l&&(void 0===i.tabIndexes[a]&&(i.tabIndexes[a]=[]),i.tabIndexes[a].push(n.attr("tabindex")||0)),n.attr({tabindex:-1,"aria-hidden":!0}).addClass("aria-hidden")}),a.attr("aria-hidden",!0).attr("tabindex","-1").addClass("aria-hidden"),this.find(v.globalTabIndexElements).filter(c.globalTabIndexElementFilter).attr({tabindex:0}).removeAttr("aria-hidden").removeClass("aria-hidden").parents(c.parentsFilter).removeAttr("aria-hidden").removeClass("aria-hidden"),this.find(v.hideableElements).filter(c.globalTabIndexElementFilter).removeAttr("tabindex").removeAttr("aria-hidden").removeClass("aria-hidden").parents(c.parentsFilter).removeAttr("aria-hidden").removeClass("aria-hidden"),p.a11y_update(),this},p.fn.a11y_popup=function(e){if(0===this.length)return this;var t=p.a11y.options;return p.a11y.state.floorStack.push(this),this.a11y_only(e,!0),0<this.length&&p(this[0]).limitedScrollTo(),t.isScrollDisabledOnPopupEnabled&&(p("html").css("overflow-y","hidden"),p.a11y.state.floorStack[p.a11y.state.floorStack.length-2].scrollDisable(),p(v.focusguard,this).css({position:"fixed",bottom:"0px"})),this},p.a11y_popdown=function(){var e=p.a11y.options,i=p.a11y.state;if(!(p.a11y.state.floorStack.length<=1)){var t=p.a11y.state.floorStack.pop();p(v.globalTabIndexElements).filter(c.globalTabIndexElementFilter).each(function(e,t){var a,n=p(t),l=0;if(null==t.a11y_uid&&(t.a11y_uid="UID"+ ++i.elementUIDIndex),a=t.a11y_uid,void 0!==i.tabIndexes[a]&&0!==i.tabIndexes[a].length&&(l=parseInt(i.tabIndexes[a].pop())),void 0!==i.tabIndexes[a]&&0<i.tabIndexes[a].length&&delete i.tabIndexes[a],n.attr({tabindex:l}),-1===l)return n.attr("aria-hidden",!0).addClass("aria-hidden");n.removeAttr("aria-hidden").removeClass("aria-hidden"),n.is(v.hideableElements)&&n.removeAttr("tabindex")});var a=i.$activeElement=i.focusStack.pop();return p.a11y_update(),e.isScrollDisabledOnPopupEnabled&&(1==i.floorStack.length&&p("html").css("overflow-y",""),p.a11y.state.floorStack[p.a11y.state.floorStack.length-1].scrollEnable(),p(v.focusguard,t).css({position:"",bottom:""})),o(function(){a==p.a11y.state.$activeElement&&(a?(i.$activeElement=a,i.$activeElement.focusOrNext().limitedScrollTo()):p.a11y_focus())},this,500),this}},p.a11y_focus=function(e){if(e){var t=p(v.focusableElements).filter(c.focusableElementsFilter);return 0<t.length&&p(t[0]).focusOrNext(),this}return o(function(){var e=p(v.focusableElements).filter(c.focusableElementsFilter);0<e.length&&p(e[0]).focusOrNext()}),this},p.fn.a11y_focus=function(){return 0===this.length||o(function(){var e=p(this[0]);if(e.is(v.focusableElements))e.focusOrNext();else{var t=e.find(v.focusableElements).filter(c.focusableElementsFilter);if(0===t.length)for(var a=e.parents(),n=0,l=a.length;n<l;n++){if(0<(t=p(a[n]).find(v.focusableElements).filter(c.focusableElementsFilter)).length)return p(t[0]).focusOrNext()}else p(t[0]).focusOrNext()}},this),this},p.fn.a11y_aria_label=function(e){var t=p.a11y.options;if(!t.isAriaLabelFixEnabled)return this;for(var a=[],n=0;n<this.length;n++){if((i=p(this[n])).not(v.ariaLabelElementsFilter).is(v.ariaLabelElements)&&a.push(this[n]),!0===e){var l=i.find(v.ariaLabelElements).filter(c.ariaLabelElementsFilter);a=a.concat(l.toArray())}}if(0===a.length)return this;for(n=0;n<a.length;n++){var i,s=(i=p(a[n])).children();if(0!==s.length){var r=s[0];if(!p(r).is(".aria-label")){var o=i.attr("aria-label");if(o){var d=p(u.arialabel);t.isTabbableTextEnabled||d.attr({tabindex:"-1"}).addClass("a11y-ignore"),d.html(o),i.prepend(d)}i.removeAttr("role").removeAttr("aria-label").removeAttr("tabindex").removeClass("aria-hidden")}}}return this}}(jQuery,window);